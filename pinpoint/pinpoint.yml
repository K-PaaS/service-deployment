# paasta-pinpoint-vsphere 설정 파일 내용
name: pinpoint                                                    # 서비스 배포이름(필수)

releases:
- name: "paasta-pinpoint-release"                                # 서비스 릴리즈 이름(필수) bosh releases로 확인 가능
  version: "1.0"                                              # 서비스 릴리즈 버전(필수):latest 시 업로드된 서비스 릴리즈 최신버전
  url: https://nextcloud.paas-ta.org/index.php/s/SJ6SoLksWEc3ckJ/download

stemcells:
- alias: default
  os: ((stemcell_os))
  version: ((stemcell_version))
  
update:
  canaries: 1                                                     # canary 인스턴스 수(필수)
  canary_watch_time: 120000                                       # canary 인스턴스가 수행하기 위한 대기 시간(필수)
  update_watch_time: 120000                                       # non-canary 인스턴스가 수행하기 위한 대기 시간(필수)
  max_in_flight: 8                                                # non-canary 인스턴스가 병렬로 update 하는 최대 개수(필수)

instance_groups:
- name: h_master                                                  # 작업 이름(필수)
  azs: ((master_azs))
  instances: ((master_instances))                                 # job 인스턴스 수(필수)
  vm_type: ((master_vm_type))
  stemcell: default
  persistent_disk_type: ((master_persistent_disk_type))
  networks:                                                       # 네트워크 구성정보          
  - name: ((private_networks_name))                               # Networks block에서 선언한 network 이름(필수)
  jobs:
  - name: h_master
    release: "paasta-pinpoint-release"
  syslog_aggregator: null
  properties:
    pem_key: ((pem_key))
    PemSSH: ((master_pem_ssh))

- name: collector                                                 # 작업 이름(필수)
  azs: ((collector_azs))
  instances: ((collector_instances))                              # job 인스턴스 수(필수)
  vm_type: ((collector_vm_type))
  stemcell: default
  persistent_disk_type: ((collector_persistent_disk_type))
  networks:                                                       # 네트워크 구성정보          
  - name: ((private_networks_name))                            # Networks block에서 선언한 network 이름(필수)
  jobs:
  - name: collector 
    release: "paasta-pinpoint-release"
  syslog_aggregator: null

- name: pinpoint_web                                              # 작업 이름(필수)
  azs: ((pinpoint_azs))
  instances: ((pinpoint_instances))                               # job 인스턴스 수(필수)
  vm_type: ((pinpoint_vm_type))
  stemcell: default
  persistent_disk_type: ((pinpoint_persistent_disk_type))
  networks:                                                       # 네트워크 구성정보          
  - name: ((private_networks_name))                             # Networks block에서 선언한 network 이름(필수)
  jobs:
  - name: pinpoint_web
    release: "paasta-pinpoint-release"
  syslog_aggregator: null

- name: broker                                                    # 작업 이름(필수)
  azs: ((broker_azs))
  instances: ((broker_instances))                                 # job 인스턴스 수(필수)
  vm_type: ((broker_vm_type))
  stemcell: default
  persistent_disk_type: ((broker_persistent_disk_type))
  networks:                                                       # 네트워크 구성정보          
  - name: ((private_networks_name))                               # Networks block에서 선언한 network 이름(필수)
  jobs:
  - name: broker
    release: "paasta-pinpoint-release"
  syslog_aggregator: null

- name: haproxy_webui                                             # 작업 이름(필수)
  azs: ((webui_azs))
  instances: ((webui_instances))                                  # job 인스턴스 수(필수)
  vm_type: ((webui_vm_type))
  stemcell: default
  persistent_disk_type: ((webui_persistent_disk_type))
  networks:                                                       # 네트워크 구성정보          
  - name: ((private_networks_name))                       # Networks block에서 선언한 network 이름(필수)
  - name: ((public_networks_name))
    static_ips: ((webui_haproxy_public_ip))
  jobs:
  - name: haproxy_webui
    release: "paasta-pinpoint-release"
  syslog_aggregator: null

properties:                                                       # Pinpoint 설정정보
  master:                                                         # Pinpoint master 설정정보
    replication: ((master_replication))                           # Pinpoint master 복제개수
    tcp_listen_port: ((master_tcp_listen_port))                   # Pinpoint master tcp port
  broker:                                                         # Pinpoint broker 설정정보
    collector_tcp_port: ((collector_tcp_port))                    # Pinpoint collector tcp port 설정정보
    collector_stat_port: ((collector_stat_port))                  # Pinpoint collector stat port 설정정보
    collector_span_port: ((collector_span_port))                  # Pinpoint collector span port 설정정보
    dashboard_uri: http://((webui_haproxy_public_ip)):80/#/main   # Pinpoint dashboard url 설정정보
  yarn:                                                           # Pinpoint yarn 설정정보      
    resource_tracker_port: ((resource_tracker_port))              # Pinpoint yarn resource_tracker_port
    scheduler_port: ((scheduler_port))                            # Pinpoint yarn scheduler_port
    resourcemanager_port: ((resourcemanager_port))                # Pinpoint yarn resourcemanager_port
